{% extends "templates/web.html" %}

{% block title %}{{ _("Send Message") }}{% endblock %}

{% block content %}
<div class="container mt-4">
	<div class="row justify-content-center">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header">
					<h4>{{ _("Send Social Media Message") }}</h4>
				</div>
				<div class="card-body">
					<form id="messageForm">
						<div class="mb-3">
							<label class="form-label">{{ _("Platform") }}</label>
							<select class="form-select" id="platform" required>
								<option value="">{{ _("Select Platform") }}</option>
								{% for platform in platforms %}
								<option value="{{ platform.lower() }}">{{ platform }}</option>
								{% endfor %}
							</select>
						</div>
						
						<div class="mb-3">
							<label class="form-label">{{ _("Recipient") }}</label>
							<input type="text" class="form-control" id="recipient" 
								   placeholder="Phone number for WhatsApp, User ID for others" required>
						</div>
						
						<div class="mb-3">
							<label class="form-label">{{ _("Message Type") }}</label>
							<select class="form-select" id="messageType">
								{% for type in message_types %}
								<option value="{{ type }}">{{ type.title() }}</option>
								{% endfor %}
							</select>
						</div>
						
						<div class="mb-3">
							<label class="form-label">{{ _("Message Content") }}</label>
							<textarea class="form-control" id="messageContent" rows="4" required></textarea>
						</div>
						
						<div class="mb-3">
							<label class="form-label">{{ _("Media URL (Optional)") }}</label>
							<input type="url" class="form-control" id="mediaUrl">
						</div>
						
						<button type="submit" class="btn btn-primary">{{ _("Send Message") }}</button>
					</form>
					
					<div id="result" class="mt-3"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
document.getElementById('messageForm').addEventListener('submit', function(e) {
	e.preventDefault();
	
	const platform = document.getElementById('platform').value;
	const recipient = document.getElementById('recipient').value;
	const messageType = document.getElementById('messageType').value;
	const messageContent = document.getElementById('messageContent').value;
	const mediaUrl = document.getElementById('mediaUrl').value;
	
	frappe.call({
		method: 'social_media.api.send_message',
		args: {
			platform: platform,
			recipient: recipient,
			message_content: messageContent,
			message_type: messageType,
			media_url: mediaUrl
		},
		callback: function(r) {
			const resultDiv = document.getElementById('result');
			if (r.message.success) {
				resultDiv.innerHTML = '<div class="alert alert-success">' + r.message.message + '</div>';
				document.getElementById('messageForm').reset();
			} else {
				resultDiv.innerHTML = '<div class="alert alert-danger">Error: ' + r.message.error + '</div>';
			}
		}
	});
});
</script>
{% endblock %}